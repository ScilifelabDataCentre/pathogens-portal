{{ define "main" }}

<!-- Main content -->
<div class="row">
  <div class="col-md-8 vert-line-right mt-3">

    {{ if ne $.Site.Language.LanguageName "Nederlands" }}
    The [Dutch COVID-19 Data Support Programme](https://www.health-ri.nl/initiatives/dutch-covid-19-data-support-programme) supports investigators and health care professionals with tools and services in their search for ways to overcome the pandemic and itsâ€¯health consequences. A specific component of this support program is the [Dutch National COVID-19 metadata portal](https://covid19initiatives.health-ri.nl/p/ProjectOverview), where information about covid-related projects within the Netherlands can be found. Guidance and answers on Ethical, Legal, and Societal Impact (ELSI) can be requisted via the [servicedesk](https://elsi.health-ri.nl/) (in Dutch).
    <!-- Available data -->
    {{ $all_entries := $.Site.Data.available_datasets.datasets }}
    {{/*
        Count how many entries we have for each data type
        */}}
    {{ $all_data_types := slice "Biochemistry data" "Drug discovery data" "Genomics & transcriptomics data" "Health data" "Imaging data" "Other data" "Protein data" "Public health data" "Serology data" "Social science and humanities data" }}
    {{ $num_entries_per_data_type := dict }}
    {{ range $all_data_types }}
    {{ $current_type := . }} {{ $num_entries := 0 }}
    {{ range $all_entries }}
    {{ $counted := false }}
    {{ range .available_items }}
    {{ if (and (in .data_type $current_type) (not $counted)) }}
    {{ $num_entries = add $num_entries 1 }}
    {{ $counted = true }}
    {{ end }}
    {{ end }}
    {{ end }}
    {{ $data_type_num_entries := dict $current_type $num_entries }}
    {{ $num_entries_per_data_type = merge $num_entries_per_data_type $data_type_num_entries }}
    {{ end }}

    {{/*
      The following bit ensures that it is not necessary to copy the datatypes_to_display list in the Swedish version of the page
    */}}

    {{ $datatypes_to_display := slice }}
    {{ $path := strings.TrimPrefix "/nl" (strings.TrimRight "/" (string .Page.RelPermalink)) }}
    {{ with .Sites.First.GetPage $path }} {{ $datatypes_to_display = .Params.datatypes_to_display }} {{ end }}

    {{ range .Site.Menus.homepage_available_data }}
      <div class="row mt-4">
        <h2>{{ .Name }}</h2>
      </div>
      <div class="row">
        <p class="small text-muted">{{ .Post }}</p>
      </div>
    {{ end }}
    <div class="row">
      {{ range .Site.Menus.datasets_menu }}
        {{ if ne .Title "All data types" }}
          <div class="col-md-4">
            <h5><a href="{{ .Page.RelPermalink }}">
              {{ $section_title := string "" }}
              {{ $section_title = .Title}}
              {{ $this_type := strings.TrimRight " data" (lower $section_title) }}
              {{ range $type, $num := $num_entries_per_data_type }}
                {{ $type_in_dict := strings.TrimRight " data" (lower $type) }}
                {{ if eq $this_type $type_in_dict }}
                  {{ if eq $section_title "Genomics & transcriptomics data"}}
                    {{ $this_type = "genomics"}}
                  {{ end }}
                  {{ if eq $section_title "Social science and humanities data"}}
                    {{ $this_type = "social science"}}
                  {{ end }}
                {{ $this_type | title }} ({{ $num }})
                {{ end }}
              {{ end }}
              <i class="bi bi-arrow-right-circle-fill"></i>
            </a></h5>
          </div>
        {{ end }}
      {{ end }}
    </div>
    {{ end }}
  </div>

  <!-- Right sidebar -->
  <div class="col-md-4 ms-auto p-3">
    <hr class="d-lg-none">

    <!-- About the portal -->
    <div class="row mt-4 mb-3">
      <h4>About this portal</h4>
      {{ .Content }}
    </div>

    <!-- Share your data ad -->
    <div class="row ps-2">
      <div class="share-new-data text-white ms-1 pb-3 px-3">
        <h4>Share new data</h4>
        The portal team is happy to assist you with submitting your data to open repositories or answer any questions about data management.
      </div>
    </div>
    <div class="row">
      <div class="col text-white pb-3 px-3">
        <h6><a style="color:white"
            href="{{ if eq $.Site.Language.LanguageName "Nederlands" }}/nl{{ end }}/share-data/">Guidelines
            <i class="bi bi-arrow-right-circle-fill"></i></a></h6>
        <h6><a style="color:white"
            href=>Support
            request <i class="bi bi-arrow-right-circle-fill"></i></a></h6>
      </div>
    </div>
  </div>
</div>

<script>
  // Add latest tag to very recent news when content is loaded
  document.addEventListener("DOMContentLoaded", function (event) {
    document.querySelectorAll("#news-items-container .small").forEach(
      function (newsNode) {
        var numDays = Math.floor((Date.now() - Date.parse(newsNode.innerText)) / (1000 * 60 * 60 * 24));
        if (numDays <= 7) {
          newsNode.insertAdjacentHTML("beforeend", "<span class='badge latest-news'>New</span>");
        }
      }
    );
  })
</script>

<script src="https://cdn.jsdelivr.net/npm/vega@5.12.1"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.0.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.8.0"></script>

<script
  src="https://datagraphics.dckube.scilifelab.se/graphic/e4c6a7b8bff648a5adaabbdd3d994bf9.js?id=serology"></script>
<script
  src="https://datagraphics.dckube.scilifelab.se/graphic/93bad55e86ad4b0f97d4d27c77862bc9.js?id=stockholm_wastewater"></script>
<script
  src="https://datagraphics.dckube.scilifelab.se/graphic/d262787e199b4c9b8fbbaf5f95edb7bc.js?id=malmo_wastewater"></script>
<script
  src="https://datagraphics.dckube.scilifelab.se/graphic/6d16b18be0d74425b313040c502f29c8.js?id=uppsala_wastewater"></script>
{{ end }}
