{{ define "main" }}

<!-- Main content -->
<div class="row">
  <div class="col-lg-8 vert-line-right mt-3">

    {{ if ne $.Site.Language.LanguageName "Svenska" }}
    <!-- Data highlights -->
    <div class="container mb-4">
      {{ range .Site.Menus.homepage_highlights }}
      <div class="row">
        <h2>{{ .Name }}</h2>
      </div>
      <div class="row">
        <p class="small text-muted">{{ .Post }}</p>
      </div>
      {{ end }}
      <div class="row">
        {{ $highlights := where .Site.RegularPages "Section" "highlights" }}
        <div class="row">
          {{ range first 3 $highlights }}
          <div class="col-md mx-2 mb-2 border bg-light">
            <img style="margin-top:0.5rem" src="{{ .Params.banner }}" alt="{{ .Title }}">
            <h6><a href="{{ .RelPermalink }}">{{ .Title }}</a></h6>
            <p class="small text-muted">{{.Date.Format "2006-01-02"}}</p>
            <p>{{ .Summary }}</p>
          </div>
          {{ end }}
        </div>
      </div>
    </div>
    {{ end }}

    {{ if ne $.Site.Language.LanguageName "Svenska" }}
    <!-- Available data -->
    {{ $all_entries := $.Site.Data.available_datasets.datasets }}
    {{/*
        Count how many entries we have for each data type
        */}}
    {{ $all_data_types := slice "Biochemistry data" "Drug discovery data" "Genomics & transcriptomics data" "Health data" "Imaging data" "Other data" "Protein data" "Public health data" "Serology data" }}
    {{ $num_entries_per_data_type := dict }}
    {{ range $all_data_types }}
    {{ $current_type := . }} {{ $num_entries := 0 }}
    {{ range $all_entries }}
    {{ $counted := false }}
    {{ range .available_items }}
    {{ if (and (in .data_type $current_type) (not $counted)) }}
    {{ $num_entries = add $num_entries 1 }}
    {{ $counted = true }}
    {{ end }}
    {{ end }}
    {{ end }}
    {{ $data_type_num_entries := dict $current_type $num_entries }}
    {{ $num_entries_per_data_type = merge $num_entries_per_data_type $data_type_num_entries }}
    {{ end }}

    {{/*
          The following bit ensures that it is not necessary to copy the datatypes_to_display list in the Swedish version of the page
          */}}

    {{ $datatypes_to_display := slice }}
    {{ $path := strings.TrimPrefix "/sv" (strings.TrimRight "/" (string .Page.RelPermalink)) }}
    {{ with .Sites.First.GetPage $path }} {{ $datatypes_to_display = .Params.datatypes_to_display }} {{ end }}

    <div class="container mb-4">
      {{ range .Site.Menus.homepage_available_data }}
      <div class="row">
        <h2>{{ .Name }}</h2>
      </div>
      <div class="row">
        <p class="small text-muted">{{ .Post }}</p>
      </div>
      {{ end }}
      <div class="row">
        <div class="row">

          {{/* This used to be range over all available data pages, need to bring back */}}

          {{ range .Site.Menus.data_menu }} {{ if eq .Title "Available datasets" }} {{ range .Children }}
          {{ if ne .Title "All data types" }} <div class="col-md-4">
            <h5><a href="{{ .Page.RelPermalink }}"> {{ $section_title := string "" }} {{ $section_title = .Title}}
                {{ $this_type := strings.TrimRight " data" (lower $section_title) }}
                {{ range $type, $num := $num_entries_per_data_type }}
                {{ $type_in_dict := strings.TrimRight " data" (lower $type) }}
                {{ if eq $this_type $type_in_dict }} {{ if eq $section_title "Genomics & transcriptomics data"}}
                {{ $this_type = "genomics"}} {{ end }} {{ $this_type | title }} ({{ $num }}) {{ end }} {{ end }} <i
                  class="bi bi-arrow-right-circle-fill"></i></a></h5>
          </div> {{ end }} {{ end }} {{ end }} {{ end }}
        </div>
      </div>
    </div>
    {{ end }}

    <!-- Sample Collection Database -->
    <div class="container mb-4">
      {{ range .Site.Menus.homepage_biobanks }}
      <div class="row">
        <h2>{{ .Name }}</h2>
      </div>
      <div class="row">
        <p class="small text-muted">{{ .Post }}</p>
      </div>
      {{ end }}
      <div class="row">
        <div class="col-md-4">
          <div class="row">
            <h5>{{ if eq $.Site.Language.LanguageName "Svenska" }}Biobanker{{ else }}Biobanks{{ end }}: 18</h5>
          </div>
          <div class="row">
            <h5>{{ if eq $.Site.Language.LanguageName "Svenska" }}Provsamlingar{{ else }}Collections{{ end }}: 35</h5>
          </div>
          <div class="row align-items-end">
            <h5><a target="_blank"
                href="https://biobanks.covid19dataportal.se/">{{ if eq $.Site.Language.LanguageName "Svenska" }}Sök i
                provsamlingsregistret{{ else }}Search in the database{{ end }} <i
                  class="bi bi-arrow-right-circle-fill"></i></a></h5>
          </div>
        </div>
        <div class="col-md-8">
          <img class="img-thumbnail" src="/img/biobanks/scd_scr.png" alt="Sample Collection Database">
        </div>
      </div>
    </div>

    <!-- Dashboards -->
    <div class="container mb-4">
      {{ range .Site.Menus.homepage_dashboards }}
      <div class="row">
        <h2>{{ .Name }}</h2>
      </div>
      <div class="row">
        <p class="small text-muted">{{ .Post }}</p>
      </div>
      {{ end }}
      <!-- Serology testing -->
      <div class="row">
        <div class="col-md mb-2">
          <div class="row">
            <h6><a
                href="{{ if eq $.Site.Language.LanguageName "Svenska" }}/sv{{ end}}/dashboards/serology-statistics/">{{ $.Param "teststats.serologytitle" }}
                <i class="bi bi-arrow-right-circle-fill"></i></a></h6>
          </div>
          <div class="row">
            <div class="d-md-none alert alert-info">{{ if eq $.Site.Language.LanguageName "Svenska" }}Skrolla grafen
              horisontellt för att se alla data.{{ else }}Scroll the plot sideways to view all data.{{ end }}</div>
            <div class="table-responsive" id="serology"></div>
          </div>
        </div>
      </div>
      <!-- Wastewater -->
      <div class="row">
        <div class="col-md mb-2">
          <div class="row">
            <h6><a
                href="{{ if eq $.Site.Language.LanguageName "Svenska" }}/sv{{ end}}/data_types/environment/wastewater/">{{ $.Param "teststats.wastewater_main_title" }}
                <i class="bi bi-arrow-right-circle-fill"></i></a></h6>
            <p><b>Please note:</b> In the graphs related to wastewater below, we display only a recent snapshot of
              wastewater data. Please go to
              our <a href="/dashboards/wastewater/">wastewater dashboard</a> for a complete view of the data available.
            </p>
          </div>
          <div class="row">
            <h6>Stockholm</h6>
            <div class="d-md-none alert alert-info">{{ if eq $.Site.Language.LanguageName "Svenska" }}Skrolla grafen
              horisontellt för att se alla data.{{ else }}Scroll the plot sideways to view all data.{{ end }}</div>
            <div class="table-responsive" id="stockholm_wastewater"></div>
          </div>
          <div class="row">
            <h6>Malmö</h6>
            <div class="d-md-none alert alert-info">{{ if eq $.Site.Language.LanguageName "Svenska" }}Skrolla grafen
              horisontellt för att se alla data.{{ else }}Scroll the plot sideways to view all data.{{ end }}</div>
            <div class="table-responsive" id="malmo_wastewater"></div>
          </div>
          <div class="row">
            <h6>Uppsala</h6>
            <div class="d-md-none alert alert-info">{{ if eq $.Site.Language.LanguageName "Svenska" }}Skrolla grafen
              horisontellt för att se alla data.{{ else }}Scroll the plot sideways to view all data.{{ end }}</div>
            <div class="table-responsive" id="uppsala_wastewater"></div>
          </div>
        </div>
      </div>
      <!-- Post-covid condition -->
      <div class="row">
        <div class="col-md mb-2">
          <div class="row">
            <h6><a
                href="{{ if eq $.Site.Language.LanguageName "Svenska" }}/sv{{ end}}/data_types/health_data/post_covid/">{{ $.Param "teststats.postcovidtitle" }}
                <i class="bi bi-arrow-right-circle-fill"></i></a></h6>
          </div>
          <div class="row">
            <div class="d-md-none alert alert-info">{{ if eq $.Site.Language.LanguageName "Svenska" }}Skrolla grafen
              horisontellt för att se alla data.{{ else }}Scroll the plot sideways to view all data.{{ end }}</div>
            <div class="table-responsive">
              <div id="https://blobserver.dckube.scilifelab.se/blob/weeklycontacts_healthcare_small.json" class="plotly"
                style="width:600px;height:300px"></div>
            </div>
            <script>
              Plotly.d3.json('https://blobserver.dckube.scilifelab.se/blob/weeklycontacts_healthcare_small.json', function (err, fig) {
                Plotly.plot('https://blobserver.dckube.scilifelab.se/blob/weeklycontacts_healthcare_small.json', fig.data, fig.layout, { responsive: true });
              });
            </script>
          </div>
        </div>
      </div>
      <!-- Vaccines -->
      <div class="row">
        <div class="col-md mb-2">
          <div class="row">
            <h6><a
                href="{{ if eq $.Site.Language.LanguageName "Svenska" }}/sv{{ end}}/data_types/health_data/vaccines/">{{ $.Param "teststats.vaccinestitle" }}
                <i class="bi bi-arrow-right-circle-fill"></i></a></h6>
          </div>
          <div class="row">
            <div class="d-md-none alert alert-info">{{ if eq $.Site.Language.LanguageName "Svenska" }}Skrolla grafen
              horisontellt för att se alla data.{{ else }}Scroll the plot sideways to view all data.{{ end }}</div>
            <div class="table-responsive">
              <div id="https://blobserver.dckube.scilifelab.se/blob/vaccine_heatmap_small.json" class="plotly"
                style="width:600px;height:300px"></div>
            </div>
            <script>
              Plotly.d3.json('https://blobserver.dckube.scilifelab.se/blob/vaccine_heatmap_small.json', function (err, fig) {
                Plotly.plot('https://blobserver.dckube.scilifelab.se/blob/vaccine_heatmap_small.json', fig.data, fig.layout, { responsive: true });
              });
            </script>
          </div>
        </div>
      </div>
      <!-- RECOVAC -->
      <div class="row">
        <div class="col-md mb-2">
          <div class="row">
            <h6><a
                href="{{ if eq $.Site.Language.LanguageName "Svenska" }}/sv{{ end}}/dashboards/recovac/">{{ $.Param "teststats.recovactitle" }}
                <i class="bi bi-arrow-right-circle-fill"></i></a></h6>
          </div>
          <div class="row">
            <div class="d-md-none alert alert-info">{{ if eq $.Site.Language.LanguageName "Svenska" }}Skrolla grafen
              horisontellt för att se alla data.{{ else }}Scroll the plot sideways to view all data.{{ end }}</div>
            <div class="table-responsive">
              <div id="https://blobserver.dckube.scilifelab.se/blob/ICUadmiss_small.json" class="plotly"
                style="width:600px;height:300px"></div>
            </div>
            <script>
              Plotly.d3.json('https://blobserver.dckube.scilifelab.se/blob/ICUadmiss_small.json', function (err, fig) {
                Plotly.plot('https://blobserver.dckube.scilifelab.se/blob/ICUadmiss_small.json', fig.data, fig.layout, { responsive: true });
              });
            </script>
          </div>
        </div>
      </div>

    </div>

  </div>

  <!-- Right sidebar -->
  <div class="col-lg-4">
    <hr class="d-lg-none">

    {{ if ne $.Site.Language.LanguageName "Svenska" }}
    <!-- Portal updates -->
    <div class="container mt-2">
      <div class="row">
        <h4>What's new?</h4>
        <p>News about new sections or features, as well as significant milestones.</p>
      </div>
      <div class="row border">
        {{ $updates := where .Site.RegularPages "Section" "updates" }}
        <div id="news-items" class="col mx-3 mb-2">
          {{ range $index, $el := first 3 $updates }}
            <div class="row small text-muted mt-3">{{ .Date.Format "2006-01-02" }}</div>
            <div class="row"><span><a href="{{ .RelPermalink }}">{{ .Title }}</a></span></div>
            {{ if ne $index 2}}<hr>{{ end }}
          {{ end }}
          <div class="row mt-3"><span><a href="/updates/">See all Portal news <i
                  class="bi bi-arrow-right-circle-fill"></i></a></span></div>
        </div>
      </div>
    </div>
    {{ end }}

    <!-- About the portal -->
    <div class="container">
      <div class="row">
        <div class="col p-0">
          <h4>{{ if eq $.Site.Language.LanguageName "Svenska" }}Om dataportalen{{ else }}About this portal{{ end }}</h4>
          {{ .Content }}
        </div>
      </div>
    </div>

    <!-- Share your data ad -->
    <br>
    <div class="container mt-2 share-new-data">
      <div class="row">
        <div class="col text-white pb-3 px-3">
          <h4>{{ if eq $.Site.Language.LanguageName "Svenska" }}Dela nya data{{ else }}Share new data{{ end }}</h4>
          {{ if eq $.Site.Language.LanguageName "Svenska" }}Teamet som arbetar med covid-19 dataportalen hjälper dig
          gärna dela dina forskningsdata i öppna databaser och svarar på frågor om datahantering.{{ else }}The portal
          team is happy to assist you with submitting your data to open repositories or answer any questions about data
          management.{{ end }}
        </div>
      </div>
      <div class="row">
        <div class="col text-white pb-3 px-3">
          <h6><a style="color:white"
              href="{{ if eq $.Site.Language.LanguageName "Svenska" }}/sv{{ end }}/share-data/">{{ if eq $.Site.Language.LanguageName "Svenska" }}Riktlinjer{{ else }}Guidelines{{ end }}
              <i class="bi bi-arrow-right-circle-fill"></i></a></h6>
          <h6><a style="color:white"
              href="{{ if eq $.Site.Language.LanguageName "Svenska" }}/sv{{ end }}/support/">{{ if eq $.Site.Language.LanguageName "Svenska" }}Stödtjänster{{ else }}Support
              request{{ end }} <i class="bi bi-arrow-right-circle-fill"></i></a></h6>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    // Add latest tag to very recent news
    document.querySelectorAll("#news-items .row.small").forEach(
        function (newsNode) {
            var numDays = Math.floor((Date.now() - Date.parse(newsNode.innerText))/(1000*60*60*24));
            if (numDays <= 7) {
                newsNode.insertAdjacentHTML("beforeend", "<span class='badge latest-news'>Latest</span>");
            }
        }
    );
</script>

<script src="https://cdn.jsdelivr.net/npm/vega@5.12.1"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.0.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.8.0"></script>

<script
  src="https://datagraphics.dckube.scilifelab.se/graphic/e4c6a7b8bff648a5adaabbdd3d994bf9.js?id=serology"></script>
<script
  src="https://datagraphics.dckube.scilifelab.se/graphic/6d16b18be0d74425b313040c502f29c8.js?id=uppsala_wastewater"></script>
<script
  src="https://datagraphics.dckube.scilifelab.se/graphic/93bad55e86ad4b0f97d4d27c77862bc9.js?id=stockholm_wastewater"></script>
<script
  src="https://datagraphics.dckube.scilifelab.se/graphic/530ca62cc6f7449680793a252155fee3.js?id=postcovid_halthcare_contacts"></script>
<script
  src="https://datagraphics.dckube.scilifelab.se/graphic/d262787e199b4c9b8fbbaf5f95edb7bc.js?id=malmo_wastewater"></script>
{{ end }}