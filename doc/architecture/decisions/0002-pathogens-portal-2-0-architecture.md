# 2. Pathogens Portal 2.0 Architecture

## Status

Draft.

## Context

The Swedish Pathogens Portal is Sweden's national Pathogens Portal Node. The aim of this portal is to ensure that research outputs related to are shared in as Open and FAIR a manner as possible. In particular, the portal focuses on research outputs related to infectious disease and pandemic preparedness generated by research affiliated with a Swedish research organisation. 

### Core Components

**Portal website:**
- The static site generator we currently use, Hugo, is augmented with JavaScript code to add dynamic capabilities. Everything is encapsulated into a single delivery unit.

**Supporting Services:**
- **Blobserver:** Stores and serves raw and processed data.
- **Form Manager:** Handles user-submitted forms.
- **DC-Dynamic:** Orchestrates scheduled job execution.
- **Pathogens Portal Visualisations:** Python scripts that process data and generate visualisations that are typically displayed on dashboards.

### Component Interactions & Information Flow

![Information flow in current Pathogens Portal](../../figures/0002-CurrentInfoFlow.png)
*Figure 1: Service-level information flow*


### Workflows to Update Content
- **Static content:** Manual edits in the codebase by Team Freya followed by new deployment.
- **Dynamic user data:** Users upload raw data to Blobserver. Team Freya configures automated scripts and cron jobs to transform and visualise the data in the static pathogen portal.
- **Dynamic team data:** Team Freya updates json files in Blobserver (related to events and funding opportunities, for example) which are analysed and injected directly into Hugo via the embedded JavaScript code to make the content appear dynamic. 

![Updating data workflow in current Pathogens Portal](../../figures/0002-CurrentActivityDiagram.png)

*Figure 2: User interaction workflows for updating content/data*

### Motivation for Pathogens Portal 2.0

The current Pathogens Portal architecture has a number of limitations, making it necessary to adopt a more dynamic, flexible and scalable system.

#### Current Limitations

From a global point of view, we are developing a dynamic site from a static framework:

1. **Too many supporting services:** each service requires dedicated maintainance work, security checks and dependency updates, which increases the workload and disperses the team's efforts. 
2. **Hard to implement data standards:** in the current workflow, there is no testing related to ensuring that the updated data and associated metadata comply with given standard, which provides very limited help to researchers.
3. **Limited automation**: in the absence of a dedicated backend, data processing and visualisation updates require manual intervention and script management, and we cannot implement automated workflows to support the sustainable addition of new features.

#### Need to redesign the Swedish Pathogens Portal

This ADR proposes a change in architecture that will address the limitations of the Swedish Pathogens Portal by transitioning it from a static website to a dynamic web application.
This will allow developers to concentrate their efforts on serving the infectious disease and pandemic preparedness research communities in Sweden more effectively by maintaining fewer services and adding new, data-centred features and automated workflows.

## Decision

We will transform the Swedish Pathogens Portal from a static website into a **service-oriented, modular web application**, eliminating all supporting services such as Blobserver and Form Manager. This new architecture comprises independently deployable components with clearly defined responsibilities, enabling the Pathogens Portal to expand in terms of both functionality and usage.

![Updating data workflow in current Pathogens Portal](../../figures/0002-portal2.0-architecture.jpg)

*Figure 3: Proposal for new Swedish Pathogens Portal architecture*

### Core Technology Stack

* **Frontend**: [Next.js](https://nextjs.org/). Responsible for rendering the user interface and interacting with APIs. Supports hybrid rendering (static and dynamic) and offers high performance for modern web delivery.

* **Backend**: [Django](https://www.djangoproject.com/). Acts as the system’s core, exposing API endpoints via Django REST framework, handling authentication, business logic, and orchestrating integrations with external systems.

* **Database**: [PostgreSQL](https://www.postgresql.org/). Stores structured content, metadata, configuration data, and supports advanced querying through features like JSONB and full-text search.

* **External Services**: These services will be consumed by the backend via their APIs:

  * **Portal storage solution:** for data uploads and file access
  * **Integrated Data Services (IDS):** for harmonised metadata and research objects
  * **External repositories:** e.g. publication indexes, genomic data archives

### Why This Architecture Approach?

We chose a **service-oriented architecture (SOA)** because it provides:

* **Loose coupling:** Components can evolve independently, enabling isolated deployments and targeted updates without affecting other parts of the application.
* **Improved scalability:** Each service can scale based on its own resource needs, supporting future growth in data volume and user traffic.
* **Separation of concerns:** Clean boundaries between UI, logic, and storage layers, facilitating easier maintenance and feature development.
* **Better integration:** External APIs can be consumed easily via backend orchestration or direct frontend queries, enabling seamless data pipeline integration.
* **AI/ML readiness:** Modular design supports easy integration of AI services, machine learning pipelines, and automated data processing workflows.
* **Future feature flexibility:** Architecture supports rapid prototyping and deployment of new features like real-time data visualisation, collaborative tools, and advanced analytics.
* **Enhanced data pipeline integration:** Service boundaries allow for sophisticated ETL processes, data validation, and transformation workflows without impacting user-facing components.
* **Microservices evolution path:** Current SOA design provides a foundation for future migration to microservices if needed for advanced use cases.
* **API-first approach:** Enables multiple client types (web, mobile, third-party integrations) while maintaining consistent data access patterns.

This approach aligns with modern web development standards preparing the portal for more complex workflows and higher data integration.


### Why These Specific Technologies?

| Component    | Technology | Justification                                                                                                                                                                     |
| ------------ | ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Frontend** | Next.js    | Combines static and dynamic rendering, SEO-friendly, React-based, and widely supported. Flexible enough to handle dashboard-style applications and traditional content rendering. |
| **Backend**  | Django     | Secure, robust, and feature-rich with a built-in admin interface, powerful ORM, and mature REST tooling. Well known to the team and easy to maintain.                             |
| **Database** | PostgreSQL | Reliable, performant, and supports advanced features such as full-text search. Integrates seamlessly with Django ORM.                                            |

### Alternatives Considered

| Option                                               | Reason for Rejection                                                                                                                       |
| ---------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| **Monolithic Django app** (Django + templates) | Creates tighter coupling between frontend and backend parts, not made to scale components independently and more difficult to implement a complete frontend frameworks. |
| **Headless CMS** (Strapi, Directus)                  | Adds operational overhead and limits customisation in terms of workflows, data validation, and complex integrations.                       |
| **Continue with Hugo + JS + APIs**                   | Already showing scalability and maintainability limits. Poor support for dynamic workflows, user roles, and content contribution features. |
| **Node.js (Express)** for backend                    | More boilerplate, lacks built-in features like Django admin. Team familiarity is lower.                                                    |


This decision positions Pathogens Portal 2.0 for long-term maintainability and expansion, with the ability to support richer content, data interactivity, editorial workflows, and integration with SciLifeLab’s broader data infrastructure.


## Consequences

Adopting a service-oriented architecture (SOA) with decoupled frontend, backend, and database components introduces both **benefits** and **trade-offs**.

### Positive Outcomes

* **Improved modularity:** Each component (frontend, backend, database) can be developed, tested, and deployed independently.
* **Scalable design:** The system can scale horizontally by distributing workload across services, enabling better handling of increased user traffic or data volumes.
* **Future-ready:** The architecture provides a strong foundation for supporting new features such as:

  * Automated content and data update workflows without requiring portal releases
  * AI-powered content summarisation and intelligent data processing
  * Real-time or scheduled data visualisations
  * Editorial workflows with automated publishing pipelines
  * Federated data integration via APIs
  * End-to-end automation from raw data ingestion to visualisation generation

* **Flexible Integrations**: External systems like Portal Storage Solution, IDS, and domain-specific repositories can be plugged in with minimal effort.


### Risks & Challenges

* **Team learning curve**: The team will need to familiarise themselves with **Next.js**, **React-based UI development**, and managing API interactions from the frontend.
* **SOA Implementation Complexity**: Adopting a service-oriented approach introduces new operational considerations such as:

  * Inter-service communication
  * Deployment coordination
  * Error handling and logging across services

* **Increased Initial Overhead**: Setting up infrastructure for independent services, CI/CD and environment management will require initial investment of time and planning.


### Mitigation & Flexibility

* The architecture is **intentionally designed to evolve**. If certain design choices prove to be blockers (e.g., service boundaries, data flows, performance), the modular nature of the system allows adjustments without major rewrites.
* Initial implementation will **reproduce the existing features** of the current Swedish Pathogens Portal, ensuring continuity. As the team gains familiarity, the architecture will support gradual rollout of more advanced features.

